import{r as J,s as W,q as G,b as X,c as Y,d as Z,_ as ee,a as te,e as oe,f as ae}from"./Layout.vue_vue_type_script_setup_true_lang-DvrN7UN2.js";import{_ as w}from"./index-BMPFyPQQ.js";import{_ as se,b as re,d as le,a as ne,c as ie}from"./CardTitle.vue_vue_type_script_setup_true_lang-DWbdFgnu.js";import{c as q,r as b,d as V,E as ue,f as y,o as r,u as e,w as s,b as t,i as u,e as o,g as de,x as ce,t as S,N as R,G as z,a as c,F as x,k as F,n as fe,D as U,S as pe,U as me,C as ve,L as ye,h as _e,J as be,K as we}from"./app-DA2OwBuc.js";import{L as he,E as ge,R as xe,S as Ce,C as ke,b as K,a as $e}from"./shield-check-B_2HhvOS.js";import{E as Se}from"./eye-CMhFNelG.js";import{_ as Fe}from"./InputError.vue_vue_type_script_setup_true_lang-kUdMBObP.js";import{_ as Te,b as Ee,c as Re,a as Ae}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CqmqabXO.js";import{_ as je}from"./DialogDescription.vue_vue_type_script_setup_true_lang-BmVOFw0F.js";import{_ as De,a as qe,b as Ve}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-Dfde29CC.js";import{e as ze}from"./useForwardExpose-DBK4_ufP.js";import{L as N}from"./loader-circle-DWby9TWo.js";import{C as Be}from"./check-CP81MTY8.js";import{_ as P}from"./index-BGeUKtuW.js";import{_ as Le}from"./AppLayout.vue_vue_type_script_setup_true_lang-mFK_bMo8.js";import"./Separator.vue_vue_type_script_setup_true_lang-CKdrjqhY.js";import"./index-BV0i58t1.js";import"./index-Aww5kpYB.js";import"./index-BfH-Pmtc.js";import"./index-DgaWUpvs.js";import"./createLucideIcon-DSygwVmt.js";import"./VisuallyHidden-DEgB8TXE.js";import"./x-C6v3_JDq.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./VisuallyHiddenInput-4xrWz3Rl.js";import"./RovingFocusGroup-CKPTfuzX.js";const D=async _=>{const i=await fetch(_,{headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`Failed to fetch: ${i.status}`);return i.json()},k=b(null),$=b(null),E=b([]),Me=q(()=>k.value!==null&&$.value!==null),B=()=>{const _=async()=>{const{svg:a}=await D(G.url());k.value=a},i=async()=>{const{secretKey:a}=await D(W.url());$.value=a},d=()=>{$.value=null,k.value=null};return{qrCodeSvg:k,manualSetupKey:$,recoveryCodesList:E,hasSetupData:Me,clearSetupData:d,clearTwoFactorAuthData:()=>{d(),E.value=[]},fetchQrCode:_,fetchSetupKey:i,fetchSetupData:async()=>{try{await Promise.all([_(),i()])}catch(a){console.error("Failed to fetch setup data:",a),k.value=null,$.value=null}},fetchRecoveryCodes:async()=>{try{E.value=await D(J.url())}catch(a){console.error("Failed to fetch recovery codes:",a),E.value=[]}}}},Oe={class:"flex flex-col gap-3 select-none sm:flex-row sm:items-center sm:justify-between"},Ke={class:"mt-3 space-y-3"},Ne={key:0,class:"space-y-2"},Pe=V({__name:"TwoFactorRecoveryCodes",setup(_){const{recoveryCodesList:i,fetchRecoveryCodes:d}=B(),f=b(!1),p=b(null),m=async()=>{!f.value&&!i.value.length&&await d(),f.value=!f.value,f.value&&(await U(),p.value?.scrollIntoView({behavior:"smooth"}))};return ue(async()=>{i.value.length||await d()}),(a,l)=>(r(),y(e(se),null,{default:s(()=>[t(e(ne),null,{default:s(()=>[t(e(re),{class:"flex gap-3"},{default:s(()=>[t(e(he),{class:"size-4"}),l[0]||(l[0]=u("2FA Recovery Codes ",-1))]),_:1,__:[0]}),t(e(le),null,{default:s(()=>l[1]||(l[1]=[u(" Recovery codes let you regain access if you lose your 2FA device. Store them in a secure password manager. ",-1)])),_:1,__:[1]})]),_:1}),t(e(ie),null,{default:s(()=>[o("div",Oe,[t(e(w),{onClick:m,class:"w-fit"},{default:s(()=>[(r(),y(ce(f.value?e(ge):e(Se)),{class:"size-4"})),u(" "+S(f.value?"Hide":"View")+" Recovery Codes ",1)]),_:1}),f.value?(r(),y(e(R),z({key:0},e(X).form(),{method:"post",options:{preserveScroll:!0},onSuccess:e(d)}),{default:s(({processing:h})=>[t(e(w),{variant:"secondary",type:"submit",disabled:h},{default:s(()=>[t(e(xe)),l[2]||(l[2]=u(" Regenerate Codes ",-1))]),_:2,__:[2]},1032,["disabled"])]),_:1},16,["onSuccess"])):de("",!0)]),o("div",{class:fe(["relative overflow-hidden transition-all duration-300",f.value?"h-auto opacity-100":"h-0 opacity-0"])},[o("div",Ke,[o("div",{ref_key:"recoveryCodeSectionRef",ref:p,class:"grid gap-1 rounded-lg bg-muted p-4 font-mono text-sm"},[e(i).length?(r(!0),c(x,{key:1},F(e(i),(h,g)=>(r(),c("div",{key:g},S(h),1))),128)):(r(),c("div",Ne,[(r(),c(x,null,F(8,h=>o("div",{key:h,class:"h-4 animate-pulse rounded bg-muted-foreground/20"})),64))]))],512),l[3]||(l[3]=o("p",{class:"text-xs text-muted-foreground select-none"},[u(" Each recovery code can be used once to access your account and will be removed after use. If you need more, click "),o("span",{class:"font-bold"},"Regenerate Codes"),u(" above. ")],-1))])],2)]),_:1})]),_:1}))}}),Ue={class:"mb-3 w-auto rounded-full border border-border bg-card p-0.5 shadow-sm"},Ie={class:"relative overflow-hidden rounded-full border border-border bg-muted p-2.5"},He={class:"absolute inset-0 grid grid-cols-5 opacity-50"},Qe={class:"absolute inset-0 grid grid-rows-5 opacity-50"},Je={class:"relative flex w-auto flex-col items-center justify-center space-y-5"},We={class:"relative mx-auto flex max-w-md items-center overflow-hidden"},Ge={class:"relative mx-auto aspect-square w-64 overflow-hidden rounded-lg border border-border"},Xe={key:0,class:"absolute inset-0 z-10 flex aspect-square h-auto w-full animate-pulse items-center justify-center bg-background"},Ye={key:1,class:"relative z-10 overflow-hidden border p-5"},Ze=["innerHTML"],et={class:"flex w-full items-center space-x-5"},tt={class:"flex w-full items-center justify-center space-x-2"},ot={class:"flex w-full items-stretch overflow-hidden rounded-xl border border-border"},at={key:0,class:"flex h-full w-full items-center justify-center bg-muted p-3"},st=["value"],rt=["value"],lt={class:"flex w-full flex-col items-center justify-center space-y-3 py-2"},nt={class:"flex w-full items-center space-x-5"},it=V({__name:"TwoFactorSetupModal",props:pe({requiresConfirmation:{type:Boolean},twoFactorEnabled:{type:Boolean}},{isOpen:{type:Boolean},isOpenModifiers:{}}),emits:["update:isOpen"],setup(_){const i=_,d=me(_,"isOpen"),{copy:f,copied:p}=ze(),{qrCodeSvg:m,manualSetupKey:a,clearSetupData:l,fetchSetupData:h}=B(),g=b(!1),C=b([]),L=q(()=>C.value.join("")),M=b(null),A=q(()=>i.twoFactorEnabled?{title:"Two-Factor Authentication Enabled",description:"Two-factor authentication is now enabled. Scan the QR code or enter the setup key in your authenticator app.",buttonText:"Close"}:g.value?{title:"Verify Authentication Code",description:"Enter the 6-digit code from your authenticator app",buttonText:"Continue"}:{title:"Enable Two-Factor Authentication",description:"To finish enabling two-factor authentication, scan the QR code or enter the setup key in your authenticator app",buttonText:"Continue"}),I=()=>{if(i.requiresConfirmation){g.value=!0,U(()=>{M.value?.querySelector("input")?.focus()});return}l(),d.value=!1},H=()=>{i.twoFactorEnabled&&l(),g.value=!1,C.value=[]};return ve(()=>d.value,async O=>{if(!O){H();return}m.value||await h()}),(O,n)=>(r(),y(e(Te),{open:d.value,"onUpdate:open":n[5]||(n[5]=v=>d.value=v)},{default:s(()=>[t(e(Ae),{class:"sm:max-w-md"},{default:s(()=>[t(e(Ee),{class:"flex items-center justify-center"},{default:s(()=>[o("div",Ue,[o("div",Ie,[o("div",He,[(r(),c(x,null,F(5,v=>o("div",{key:`col-${v}`,class:"border-r border-border last:border-r-0"})),64))]),o("div",Qe,[(r(),c(x,null,F(5,v=>o("div",{key:`row-${v}`,class:"border-b border-border last:border-b-0"})),64))]),t(e(Ce),{class:"relative z-20 size-6 text-foreground"})])]),t(e(Re),null,{default:s(()=>[u(S(A.value.title),1)]),_:1}),t(e(je),{class:"text-center"},{default:s(()=>[u(S(A.value.description),1)]),_:1})]),_:1}),o("div",Je,[g.value?(r(),y(e(R),z({key:1},e(Y).form(),{"reset-on-error":"",onFinish:n[3]||(n[3]=v=>C.value=[]),onSuccess:n[4]||(n[4]=v=>d.value=!1)}),{default:s(({errors:v,processing:j})=>[o("input",{type:"hidden",name:"code",value:L.value},null,8,rt),o("div",{ref_key:"pinInputContainerRef",ref:M,class:"relative w-full space-y-3"},[o("div",lt,[t(e(De),{id:"otp",placeholder:"â—‹",modelValue:C.value,"onUpdate:modelValue":n[1]||(n[1]=T=>C.value=T),type:"number",otp:""},{default:s(()=>[t(e(qe),null,{default:s(()=>[(r(),c(x,null,F(6,(T,Q)=>t(e(Ve),{autofocus:"",key:T,index:Q,disabled:j},null,8,["index","disabled"])),64))]),_:2},1024)]),_:2},1032,["modelValue"]),t(Fe,{message:v?.confirmTwoFactorAuthentication?.code},null,8,["message"])]),o("div",nt,[t(e(w),{type:"button",variant:"outline",class:"w-auto flex-1",onClick:n[2]||(n[2]=T=>g.value=!1),disabled:j},{default:s(()=>n[7]||(n[7]=[u(" Back ",-1)])),_:2,__:[7]},1032,["disabled"]),t(e(w),{type:"submit",class:"w-auto flex-1",disabled:j||L.value.length<6},{default:s(()=>n[8]||(n[8]=[u(" Confirm ",-1)])),_:2,__:[8]},1032,["disabled"])])],512)]),_:1},16)):(r(),c(x,{key:0},[o("div",We,[o("div",Ge,[e(m)?(r(),c("div",Ye,[o("div",{innerHTML:e(m),class:"flex aspect-square size-full items-center justify-center"},null,8,Ze)])):(r(),c("div",Xe,[t(e(N),{class:"size-6 animate-spin"})]))])]),o("div",et,[t(e(w),{class:"w-full",onClick:I},{default:s(()=>[u(S(A.value.buttonText),1)]),_:1})]),n[6]||(n[6]=o("div",{class:"relative flex w-full items-center justify-center"},[o("div",{class:"absolute inset-0 top-1/2 h-px w-full bg-border"}),o("span",{class:"relative bg-card px-2 py-1"},"or, enter the code manually")],-1)),o("div",tt,[o("div",ot,[e(a)?(r(),c(x,{key:1},[o("input",{type:"text",readonly:"",value:e(a),class:"h-full w-full bg-background p-3 text-foreground"},null,8,st),o("button",{onClick:n[0]||(n[0]=v=>e(f)(e(a)||"")),class:"relative block h-auto border-l border-border px-3 hover:bg-muted"},[e(p)?(r(),y(e(Be),{key:0,class:"w-4 text-green-500"})):(r(),y(e(ke),{key:1,class:"w-4"}))])],64)):(r(),c("div",at,[t(e(N),{class:"size-4 animate-spin"})]))])])],64))])]),_:1})]),_:1},8,["open"]))}}),ut={class:"space-y-6"},dt={key:0,class:"flex flex-col items-start justify-start space-y-4"},ct={key:1,class:"flex flex-col items-start justify-start space-y-4"},ft={class:"relative inline"},Mt=V({__name:"TwoFactor",props:{requiresConfirmation:{type:Boolean,default:!1},twoFactorEnabled:{type:Boolean,default:!1}},setup(_){const i=[{title:"Two-Factor Authentication",href:Z.url()}],{hasSetupData:d,clearTwoFactorAuthData:f}=B(),p=b(!1);return ye(()=>{f()}),(m,a)=>(r(),y(Le,{breadcrumbs:i},{default:s(()=>[t(e(_e),{title:"Two-Factor Authentication"}),t(ee,null,{default:s(()=>[o("div",ut,[t(te,{title:"Two-Factor Authentication",description:"Manage your two-factor authentication settings"}),m.twoFactorEnabled?(r(),c("div",ct,[t(e(P),{variant:"default"},{default:s(()=>a[7]||(a[7]=[u("Enabled",-1)])),_:1,__:[7]}),a[9]||(a[9]=o("p",{class:"text-muted-foreground"}," With two-factor authentication enabled, you will be prompted for a secure, random pin during login, which you can retrieve from the TOTP-supported application on your phone. ",-1)),t(Pe),o("div",ft,[t(e(R),be(we(e(ae).form())),{default:s(({processing:l})=>[t(e(w),{variant:"destructive",type:"submit",disabled:l},{default:s(()=>[t(e($e)),a[8]||(a[8]=u(" Disable 2FA ",-1))]),_:2,__:[8]},1032,["disabled"])]),_:1},16)])])):(r(),c("div",dt,[t(e(P),{variant:"destructive"},{default:s(()=>a[3]||(a[3]=[u("Disabled",-1)])),_:1,__:[3]}),a[6]||(a[6]=o("p",{class:"text-muted-foreground"}," When you enable two-factor authentication, you will be prompted for a secure pin during login. This pin can be retrieved from a TOTP-supported application on your phone. ",-1)),o("div",null,[e(d)?(r(),y(e(w),{key:0,onClick:a[0]||(a[0]=l=>p.value=!0)},{default:s(()=>[t(e(K)),a[4]||(a[4]=u("Continue Setup ",-1))]),_:1,__:[4]})):(r(),y(e(R),z({key:1},e(oe).form(),{onSuccess:a[1]||(a[1]=l=>p.value=!0)}),{default:s(({processing:l})=>[t(e(w),{type:"submit",disabled:l},{default:s(()=>[t(e(K)),a[5]||(a[5]=u("Enable 2FA",-1))]),_:2,__:[5]},1032,["disabled"])]),_:1},16))])])),t(it,{isOpen:p.value,"onUpdate:isOpen":a[2]||(a[2]=l=>p.value=l),requiresConfirmation:m.requiresConfirmation,twoFactorEnabled:m.twoFactorEnabled},null,8,["isOpen","requiresConfirmation","twoFactorEnabled"])])]),_:1})]),_:1}))}});export{Mt as default};
